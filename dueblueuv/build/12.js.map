{"version":3,"sources":["../../src/pages/nuevacita-modal/nuevacita-modal.module.ts","../../src/pages/nuevacita-modal/nuevacita-modal.ts"],"names":[],"mappings":"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","file":"12.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { NuevacitaModalPage } from './nuevacita-modal';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    NuevacitaModalPage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(NuevacitaModalPage),\r\n  ],\r\n})\r\nexport class NuevacitaModalPageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/nuevacita-modal/nuevacita-modal.module.ts","import { Component } from '@angular/core';\r\nimport { IonicPage, NavController, NavParams, LoadingController, ToastController, ViewController, AlertController } from 'ionic-angular';\r\nimport { UserDataProvider } from '../../providers/user-data/user-data';\r\nimport { Citas } from '../../providers/user-data/citas';\r\nimport { Debugger } from '../../providers/user-data/debugger';\r\nimport { CitasManagerProvider } from '../../providers/citas-manager/citas-manager';\r\nimport { NotificationsManagerProvider } from '../../providers/notifications-manager/notifications-manager';\r\nimport { LoaderProvider } from '../../providers/loader/loader';\r\nimport { WebsocketServiceProvider } from '../../providers/websocket-service/websocket-service';\r\nimport { AlertProvider } from '../../providers/alert/alert';\r\nimport { WsMessengerProvider } from '../../providers/ws-messenger/ws-messenger';\r\nimport { DoctoresDataProvider } from '../../providers/doctores-data/doctores-data';\r\nimport { PermissionsProvider } from '../../providers/permissions/permissions';\r\n\r\n/**\r\n * Generated class for the NuevacitaModalPage page.\r\n *\r\n * See https://ionicframework.com/docs/components/#navigation for more info on\r\n * Ionic pages and navigation.\r\n */\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-nuevacita-modal',\r\n  templateUrl: 'nuevacita-modal.html',\r\n})\r\n\r\n\r\n\r\n\r\nexport class NuevacitaModalPage {\r\n  cita:Citas = null;\r\n  isnew:boolean = true;\r\n  selectedDate:string = null;\r\n  \r\n  constructor(\r\n    public navCtrl: NavController, \r\n    public navParams: NavParams,\r\n    public userData: UserDataProvider,\r\n    public viewCtrl: ViewController,\r\n    public citasMan: CitasManagerProvider,\r\n    public notiMan: NotificationsManagerProvider,\r\n    public loader: LoaderProvider,\r\n    public alert: AlertProvider,\r\n    public wsMessenger: WsMessengerProvider,\r\n    public docData: DoctoresDataProvider,\r\n    public permissions: PermissionsProvider\r\n  ) {\r\n    console.log('GETTING CITA', navParams.get('cita'));\r\n    let aux_node = navParams.get('cita');\r\n    if(aux_node){\r\n      this.cita = aux_node;\r\n      Debugger.log(['cita en modal es',this.cita]);\r\n      this.isnew = false;\r\n    }else{\r\n      this.isnew = true;\r\n      this.resetNewCita();\r\n      this.selectedDate = Citas.getLocalDateIso(new Date());//new Date().toISOString();\r\n    }\r\n  }\r\n\r\n  dismiss() {\r\n    this.viewCtrl.dismiss();\r\n  }\r\n\r\n  resetNewCita(){\r\n    this.cita = new Citas();\r\n  }\r\n\r\n  ionViewDidLoad() {\r\n    console.log('ionViewDidLoad NuevacitaModalPage');\r\n  }\r\n\r\n\r\n  async createCita(){\r\n    if(!this.basicNewCitaValidation()){ return false; }\r\n    this.loader.presentLoader('creando cita...');\r\n    this.cita.data.field_estado.und[\"0\"].value = 0;\r\n    if(this.userData.checkUserPermission([this.userData.TIPO_DOCTOR])){\r\n      this.cita.data.field_cita_doctor.und[0]=this.userData.userData.uid;\r\n    }\r\n      this.cita.data.field_cita_recepcion.und[0]=this.userData.userData.uid; //esto es quien creo la cita\r\n      this.cita.data.field_cita_caja.und[0]=\"_none\"; //quien cobro la cita\r\n      this.cita.caja_playerid = null;\r\n      this.cita.data.field_servicios_cita.und = []; //limpiamos los servicios porque nos deja basura\r\n      this.setCitaDateFromiNPUT();\r\n    await this.citasMan.generateNewCita( this.cita.data ).subscribe(\r\n    (val)=>{\r\n      console.log(val.nid);\r\n      this.notiMan.generateNotification([this.cita.data.field_cita_doctor.und[0]],`Nueva Cita con ${this.cita.paciente} fecha: ${new Date(this.cita.data.field_datemsb['und'][0]['value'])}`,`cita-${this.cita.Nid}`);\r\n      this.cita.data.Nid = val.nid;\r\n      this.cita.Nid = val.nid;\r\n      this.wsMessenger.generateWSupdateMessage(this.cita);\r\n    },\r\n    response => {\r\n        console.log(\"POST call in error\", response);\r\n        console.log(\"show error\");\r\n        for (var key in response.error.form_errors) {\r\n          this.alert.presentAlert(key, response.error.form_errors[key]);\r\n        }\r\n      }\r\n  );\r\n  //await this.citasMan.requestCitas().toPromise();\r\n  this.loader.dismissLoader();\r\n  this.close();\r\n}\r\n\r\nbasicNewCitaValidation(){\r\n  let ret = true;\r\n  if(this.userData.checkUserPermission([this.userData.TIPO_DOCTOR])){\r\n  }\r\n  else{\r\n    if( Number(this.cita.data.field_cita_doctor.und[0]) === 0 ){\r\n      this.alert.presentAlert('Error','Debe elegir un doctor para esta cita');\r\n      ret = false;\r\n    }\r\n  }\r\n  return ret;\r\n}\r\n\r\nasync updateCita(){\r\n  this.loader.presentLoader('actualizando ...');\r\n  this.setCitaDateFromiNPUT();\r\n  await this.citasMan.updateCita( this.cita.data ).subscribe(\r\n    (val)=>{\r\n      this.wsMessenger.generateWSupdateMessage(this.cita);    \r\n    },\r\n    response => {\r\n      console.log(\"POST call in error\", response);\r\n      console.log(\"show error\");\r\n      for (var key in response.error.form_errors) {\r\n        this.alert.presentAlert(key, response.error.form_errors[key]);\r\n      }\r\n    }\r\n  );\r\n  this.loader.dismissLoader();\r\n  this.close();\r\n}\r\n\r\n\r\nclose(){\r\n  this.viewCtrl.dismiss();\r\n}\r\n\r\n\r\n\r\nsetCitaDateFromiNPUT(){\r\n  //get the timezoned input and put it on utc on this format 2018-07-04 14:30:00-07:00 to set data using citas code\r\n  //Debugger.log(['string that not works now is',this.selectedDate],false);\r\n  //this.cita.setDate(this.selectedDate,true);\r\n  let now = new Date();\r\n  Debugger.log([this.selectedDate]);\r\n  let auxdate = new Date(this.selectedDate);\r\n  Debugger.log([`times dif are now ${now.getTime()} vs sel ${auxdate.getTime()}`]);\r\n  Debugger.log([`offset is`,new Date().getTimezoneOffset()]);\r\n  let dateUT = auxdate.getTime();\r\n  const offset = (new Date().getTimezoneOffset() * 60 * 1000 * 2); // offset is in minutes so 60 * 1000 to get  milliseconds\r\n  dateUT = dateUT + offset;\r\n  this.cita.setDateUT(dateUT);\r\n  this.cita.data.field_datemsb['und'][0]['value'] = dateUT;\r\n  Debugger.log([`saving ${dateUT} for ${new Date(dateUT)}`]);\r\n}\r\n\r\n}\r\n\r\n/**\r\n * Esto de aqui es para que el date me de el toisostring en la hora de aqui\r\n *  **/\r\n/*\r\nDate.prototype.toISOString = function() {\r\n  var tzo = -this.getTimezoneOffset(),\r\n      dif = tzo >= 0 ? '+' : '-',\r\n      pad = function(num) {\r\n          var norm = Math.floor(Math.abs(num));\r\n          return (norm < 10 ? '0' : '') + norm;\r\n      };\r\n  return this.getFullYear() +\r\n      '-' + pad(this.getMonth() + 1) +\r\n      '-' + pad(this.getDate()) +\r\n      'T' + pad(this.getHours()) +\r\n      ':' + pad(this.getMinutes()) +\r\n      ':' + pad(this.getSeconds()) +\r\n      dif + pad(tzo / 60) +\r\n      ':' + pad(tzo % 60);\r\n}*/\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/nuevacita-modal/nuevacita-modal.ts"],"sourceRoot":""}