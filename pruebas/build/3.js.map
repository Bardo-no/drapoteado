{"version":3,"sources":["../../src/pages/usuarios/usuarios.module.ts","../../src/pages/usuarios/usuarios.ts"],"names":[],"mappings":"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","file":"3.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { UsuariosPage } from './usuarios';\r\nimport { ComponentsModule } from '../../components/components.module';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    UsuariosPage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(UsuariosPage),\r\n    ComponentsModule\r\n  ],\r\n})\r\nexport class UsuariosPageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/usuarios/usuarios.module.ts","import { Component } from '@angular/core';\r\nimport { IonicPage, NavController, NavParams, ViewController } from 'ionic-angular';\r\nimport { ModalController } from 'ionic-angular';\r\nimport {  UserDataProvider } from '../../providers/user-data/user-data';\r\nimport { DrupalUserManagerProvider } from '../../providers/drupal-user-manager/drupal-user-manager';\r\nimport { LoaderProvider } from '../../providers/loader/loader';\r\nimport { AlertProvider } from '../../providers/alert/alert';\r\nimport { SubusersDataProvider } from '../../providers/subusers-data/subusers-data';\r\nimport { SubusersManagerProvider } from '../../providers/subusers-manager/subusers-manager';\r\nimport { PermissionsProvider } from '../../providers/permissions/permissions';\r\nimport { SubscriptionDataProvider } from '../../providers/subscription-data/subscription-data';\r\nimport { WsMessengerProvider } from '../../providers/ws-messenger/ws-messenger';\r\n\r\n\r\n/**\r\n * Generated class for the UsuariosPage page.\r\n *\r\n * See https://ionicframework.com/docs/components/#navigation for more info on\r\n * Ionic pages and navigation.\r\n */\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-usuarios',\r\n  templateUrl: 'usuarios.html',\r\n})\r\nexport class UsuariosPage {\r\n  //usersd:userd[];\r\n  get subusersLimit():number{\r\n   return this.subsData.getSubAccountsTotal();\r\n  }\r\n  get subUsersLeft(){\r\n    return this.subsData.getSubAccountsLeft();\r\n  }\r\n\r\n  constructor(\r\n    public navCtrl: NavController, \r\n    public navParams: NavParams, \r\n    public modalCtrl: ModalController, \r\n    public userData:UserDataProvider,\r\n    public viewCtrl: ViewController,\r\n    public userMan: DrupalUserManagerProvider,\r\n    public loader: LoaderProvider,\r\n    public alert: AlertProvider,\r\n    public subsData: SubscriptionDataProvider,\r\n    public subuserData: SubusersDataProvider,\r\n    public subusersManager: SubusersManagerProvider,\r\n    public permissions: PermissionsProvider,\r\n    public WS:WsMessengerProvider\r\n  ) {\r\n    //this.usersd = new Array();\r\n  }\r\n\r\n  ionViewDidLoad() {\r\n    console.log('ionViewDidLoad UsuariosPage');\r\n    console.log('getting subusers limit',this.subsData.getSubAccountsLeft());\r\n    this.cargarUsuarios();\r\n  }\r\n\r\n  /*\r\n    cargar usuarios carga los usuarios de la subscripcion y los usuarios que tienes agregados.\r\n  **/\r\n async cargarUsuarios(){\r\n this.loader.presentLoader('Cargando Usuarios ...');\r\n await this.subusersManager.cargarSubusuarios();\r\n //await this.subusersManager.cargarSubusuariosSubs();\r\n console.log('subscription subusers loaded end',this.subuserData.subscriptionSubUsers);\r\n this.loader.dismissLoader();\r\n  /*this.usersd = new Array();\r\n  let doctors_array =  new Array();\r\n  doctors_array.push(this.userData.userData.uid);\r\n  let ids = null;\r\n  //if(this.userData.checkUserPlanHolder() && this.userData.subscription.field_subusuarios){\r\n    //si es planholder no busca sus usuarios si no todos los usuarios de esta subscripcion\r\n    //ids = this.userData.subscription.field_subusuarios;\r\n    //Debugger.log(['subusers ids to load',ids]);\r\n    //doctors_array = null;\r\n  //}\r\n  this.userMan.requestUsers(doctors_array, null, ids).subscribe(\r\n    (val)=>{ \r\n      let aux_results = Object.keys(val).map(function (key) { return val[key]; });\r\n      aux_results.forEach((element) => {\r\n        Debugger.log(['received userd',element]);\r\n        let aux_user = this.userData.getEmptyUserd();\r\n        aux_user.uid = element.uid;\r\n        aux_user.name = element.name;\r\n        aux_user.field_alias.und[0].value = element.field_alias;\r\n        aux_user.field_nombre.und[0].value = element.field_nombre;\r\n        aux_user.field_apellidos.und[0].value = element.field_apellidos;\r\n        aux_user.field_useremail.und[0].email = element.field_useremail.email;\r\n        aux_user.mail = element.mail;\r\n        aux_user.status = \"1\";\r\n        aux_user.field_doctores.und = new Array();\r\n        let aux_docs = Object.keys(element.field_doctores).map(function (key) { return element.field_doctores[key]; });\r\n        aux_docs.forEach(function(element){\r\n          console.log(\"entrodeucing\",element);\r\n          aux_user.field_doctores.und.push(element.uid);\r\n        });\r\n        console.log(element.field_tipo_de_usuario);\r\n        aux_user.field_tipo_de_usuario.und = new Array();\r\n        let aux_tipos = Object.keys(element.field_tipo_de_usuario).map(function (key) { return element.field_tipo_de_usuario[key]; });\r\n        aux_tipos.forEach(function(element){\r\n          aux_user.field_tipo_de_usuario.und.push(element);\r\n        });\r\n        console.log( aux_user.field_tipo_de_usuario);\r\n        this.usersd.push(aux_user);\r\n     });\r\n     console.log(this.usersd);\r\n     loading.dismiss();\r\n    },\r\n     response => {\r\n       console.log(\"POST call in error\", response);\r\n       loading.dismiss();\r\n     }\r\n    );*/\r\n}\r\n\r\n  openNuevousuario(){\r\n    console.log('subs restantes',this.subsData.getSubAccountsLeft());\r\n    if(this.subsData.getSubAccountsLeft() > 0  ){ \r\n    let Modal = this.modalCtrl.create(\"NuevousuarioModalPage\", undefined, { cssClass: \"smallModal nuevousuarioModal\" });\r\n    Modal.onDidDismiss(data => {\r\n      if(data !== null){\r\n        if(data.changed === true){\r\n          this.cargarUsuarios();\r\n        }\r\n      }\r\n    });\r\n    Modal.present({});\r\n  }else{\r\n    this.alert.presentAlert('Error','No puedes agregar mas usuarios')\r\n  }\r\n  }\r\n\r\n  editUsuario( userd ){\r\n    let Modal = this.modalCtrl.create(\"NuevousuarioModalPage\", { 'userd': userd }, { cssClass: \"smallModal nuevousuarioModal\" });\r\n    Modal.present({});\r\n  }\r\n\r\n  \r\n  deleteUsuario( userd , fromSub:boolean = false){\r\n    this.alert.chooseAlert(\r\n      'Eliminar',\r\n      '¿Está seguro de que desea eliminar este usuario de la subscripción?',\r\n      ()=>{ /*this.removeSubUserFromSubs(userd);*/this.completeSubUserRemove( userd );  },\r\n      ()=>{}\r\n    );\r\n  }\r\n\r\n  removeUsuariopop( userd , fromSub:boolean = false){\r\n    this.alert.chooseAlert(\r\n      'Remover',\r\n      '¿Está seguro de que desea remover? El usuario no se borrará, solo dejará de administrar sus citas',\r\n      ()=>{  /*this.removeUsuario( userd );*/ /*this.removeSubUserFromSubs(userd);*/ this.completeSubUserRemove( userd ); },\r\n      ()=>{}\r\n    );\r\n  }\r\n\r\n  agregarusuariopop( userd ){\r\n  \r\n    this.alert.chooseAlert(\r\n      'Agregar',\r\n      '¿Está seguro de que desea asignarse a este usuario? El usuario administrara sus citas',\r\n      ()=>{  this.addUsuario( userd ); },\r\n      ()=>{}\r\n    );\r\n    \r\n  }\r\n\r\n\r\n  async removeUsuario( userd ){\r\n    this.loader.presentLoader(\"removiendo usuario . . .\");\r\n    await this.subusersManager.removeSubuser(userd);\r\n    await this.subusersManager.cargarSubusuarios();\r\n    console.log('is removed yet?');\r\n    this.loader.dismissLoader();\r\n    //remove this user from array of doctors\r\n    /*SubusersManagerProvider.removeDoctorFromSubUser(userd, this.userData.userData.uid);\r\n    delete userd.field_sub_id;\r\n    this.user\r\n    console.log('ready to upodate',userd);*/\r\n    /*\r\n    this.userMan.updateUserd( userd ).subscribe(\r\n      (val)=>{\r\n        console.log(\"usuarioUpdated\");\r\n        this.presentToast(\"Completado\");\r\n        \r\n        this.cargarUsuarios();\r\n      },\r\n      response => {\r\n      \r\n        console.log(\"POST call in error\", response);\r\n        console.log(\"show error\");\r\n        for (var key in response.error.form_errors) {\r\n          this.presentAlert(key, response.error.form_errors[key]);\r\n        }\r\n      }\r\n    );*/\r\n  }\r\n\r\n  async addUsuario( userd ){\r\n    this.loader.presentLoader('Agregando usuario ...');\r\n    await this.subusersManager.addSubuser(userd);\r\n    await this.subusersManager.cargarSubusuarios();\r\n    this.loader.dismissLoader();\r\n    /*if( !userd.field_doctores.und ){  userd.field_doctores.und = new Array();}\r\n    userd.field_doctores.und.push(this.userData.userData.uid);\r\n    delete userd.field_sub_id;\r\n    this.userMan.updateUserd( userd ).subscribe(\r\n      (val)=>{\r\n        console.log(\"usuarioUpdated\");\r\n        this.presentToast(\"Completado\");\r\n        loader.dismiss();\r\n        this.cargarUsuarios();\r\n      },\r\n      response => {\r\n        loader.dismiss();\r\n        console.log(\"POST call in error\", response);\r\n        console.log(\"show error\");\r\n        for (var key in response.error.form_errors) {\r\n          this.presentAlert(key, response.error.form_errors[key]);\r\n        }\r\n      }\r\n    );*/\r\n  }\r\n\r\n\r\n\r\n\r\n  async removeSubUserFromSubs( userd ){\r\n    this.loader.presentLoader('Eliminando usuario ...');\r\n    //await this.subusersManager.removeSubuser(userd);\r\n    await this.subusersManager.removeUserFromSubscription(userd);\r\n    await this.subusersManager.cargarSubusuarios();\r\n    console.log('is removed yet?');\r\n    this.loader.dismissLoader();\r\n    /*let loader = this.loadingCtrl.create({\r\n      content: \"removiendo usuario . . .\"\r\n    });\r\n    loader.present();\r\n    if(this.userData.checkUserPlanHolder()){\r\n      this.userData.subscription.removeSubUserFromSubs(userd);\r\n      this.userData.updateSus(this.userData.subscription).subscribe(\r\n        (val)=>{\r\n          loader.dismiss();\r\n          this.cargarUsuarios();\r\n        }\r\n      );\r\n    }*/\r\n  }\r\n\r\n  async completeSubUserAdd( ){\r\n    \r\n  }\r\n\r\n  async completeSubUserRemove( userd ){ //ya hice este metodo despues de tantos cambios maldicion\r\n    console.log('CHEKAME WEY');\r\n    this.loader.presentLoader('Removiendo usuario ...');\r\n    //await this.subusersManager.removeSubuser(userd);\r\n    await this.subusersManager.removeUserFromSubscription( userd );\r\n    console.log('CHEKAME WEY a ');\r\n    await this.subusersManager.removeSubuser(userd);\r\n    console.log('CHEKAME WEY b');\r\n    await this.subusersManager.cargarSubusuarios();\r\n    console.log('CHEKAME WEY c');\r\n    this.WS.generateSuboutofgroup(this.subsData.subscription.field_doctores,userd.uid);\r\n    //console.log('is removed yet?');\r\n    this.loader.dismissLoader();\r\n  }\r\n\r\n\r\n  \r\n\r\n\r\n\r\n\r\n\r\n  \r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/usuarios/usuarios.ts"],"sourceRoot":""}